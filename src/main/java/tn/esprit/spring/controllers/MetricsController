package tn.esprit.spring.controllers;

import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.RestController;
import java.lang.management.ManagementFactory;
import java.lang.management.MemoryMXBean;
import java.lang.management.OperatingSystemMXBean;

@RestController
public class MetricsController {

    private final MemoryMXBean memoryBean = ManagementFactory.getMemoryMXBean();
    private final OperatingSystemMXBean osBean = ManagementFactory.getOperatingSystemMXBean();

    @GetMapping("/metrics")
    public String getMetrics() {
        long usedHeap = memoryBean.getHeapMemoryUsage().getUsed();
        long maxHeap = memoryBean.getHeapMemoryUsage().getMax();
        double systemLoad = osBean.getSystemLoadAverage();

        return String.format(
            "custom_memory_used_bytes %d\n" +
            "custom_memory_max_bytes %d\n" +
            "custom_system_load_average %f\n",
            usedHeap, maxHeap, systemLoad
        );
    }
}
